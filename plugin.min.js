tinymce.PluginManager.add("mathjax",function(t,e){let n=t.settings.mathjax.className||"math-tex",a=n+"-original",l=t.settings.mathjax.symbols||{inline:{start:"\\(",end:"\\)"},block:{start:"\\[",end:"\\]"}},i="inline",o=t.settings.mathjax.lib||null,s=[(t.settings.mathjax.configUrl||e+"/config.js")+"?class="+a];o&&s.push(o),t.on("init",function(){let e=t.getDoc().getElementsByTagName("script");for(let n=0;n<s.length;n++){let a=t.dom.uniqueId(),l=t.dom.create("script",{id:a,type:"text/javascript",src:s[n]}),i=!1;for(let t=0;t<e.length;t++)if(e[t].src==l.src){i=!0;break}i||t.getDoc().getElementsByTagName("head")[0].appendChild(l)}}),t.on("GetContent",function(e){let a=t.dom.create("div");a.innerHTML=e.content;let l=a.querySelectorAll("."+n);for(let t=0;t<l.length;t++){let e=l[t].querySelectorAll("span");for(let t=0;t<e.length;t++)e[t].remove();let n=l[t].getAttribute("data-latex");l[t].removeAttribute("contenteditable"),l[t].removeAttribute("style"),l[t].removeAttribute("data-latex"),l[t].innerHTML=n}e.content=a.innerHTML});let r=function(e){if(2!=e.childNodes.length){e.setAttribute("contenteditable",!1),e.style.cursor="pointer";let n=e.getAttribute("data-latex")||e.innerHTML;e.setAttribute("data-latex",n),e.innerHTML="";let l=t.dom.create("span");l.innerHTML=n,l.classList.add(a),e.appendChild(l);let i=t.dom.create("span");i.classList.add("dummy"),i.innerHTML="dummy",i.setAttribute("hidden","hidden"),e.appendChild(i)}};t.on("BeforeSetContent",function(e){let a=t.dom.create("div");a.innerHTML=e.content;let l=a.querySelectorAll("."+n);for(let t=0;t<l.length;t++)r(l[t]);e.content=a.innerHTML}),t.on("SetContent",function(e){t.getDoc().defaultView.MathJax&&(t.getDoc().defaultView.MathJax.startup.getComponents(),t.getDoc().defaultView.MathJax.typeset())}),t.ui.registry.addToggleButton("mathjax",{text:"Î£",tooltip:"Mathjax",onAction:function(){let e=t.selection.getNode(),a=void 0;e.classList.contains(n)&&(a=e),c(a)},onSetup:function(e){return t.selection.selectorChangedWithUnbind("."+n,e.setActive).unbind}}),t.on("click",function(t){let e=t.target.closest("."+n);e&&c(e)});let c=function(e){let o=t.dom.uniqueId(),c="";e&&(latex_attribute=e.getAttribute("data-latex"),i=latex_attribute.substring(0,l.block.start.length)===l.block.start?"block":"inline",latex_attribute.length>=(l[i].start+l[i].end).length&&(c=latex_attribute.substr(l[i].start.length,latex_attribute.length-(l[i].start+l[i].end).length))),t.windowManager.open({title:"Mathjax",width:600,height:300,body:{type:"panel",items:[{type:"textarea",name:"title",label:"LaTex"},{type:"htmlpanel",html:'<div style="text-align:right"><a href="https://wikibooks.org/wiki/LaTeX/Mathematics" target="_blank" style="font-size:small">LaTex</a></div>'},{type:"selectbox",name:"style",size:1,items:[{value:"inline",text:"inline"},{value:"block",text:"block"}],label:tinymce.util.I18n.translate("Render display style")},{type:"htmlpanel",html:'<iframe id="'+o+'" style="width: 100%; min-height: 50px;"></iframe>'}]},buttons:[{type:"submit",text:"OK"}],onSubmit:function(a){let l=a.getData().title.trim();if(e)e.innerHTML="",e.setAttribute("data-latex",p(l)),r(e);else{let e=t.getDoc().createElement("span");e.innerHTML=p(l),e.classList.add(n),r(e),t.insertContent(e.outerHTML)}t.getDoc().defaultView.MathJax.startup.getComponents(),t.getDoc().defaultView.MathJax.typeset(),a.close()},onChange:function(t){i=t.getData().style;var e=t.getData().title.trim();e!=c&&(b(e,document.getElementById(o)),c=e)},initialData:{title:c,style:i}});let d=document.getElementById(o),u=d.contentWindow||d.contentDocument.document||d.contentDocument,m=u.document,g=m.getElementsByTagName("head")[0],h=m.getElementsByTagName("body")[0],p=function(t,e){return e||(e=l[i]),e.start+" "+t+" "+e.end},b=function(t){let e=u.MathJax,n=h.querySelector("div");n||((n=m.createElement("div")).classList.add(a),h.appendChild(n)),n.innerHTML=p(t,{start:"$$",end:"$$"}),e&&e.startup&&(e.startup.getComponents(),e.typeset())};b(c);for(let t=0;t<s.length;t++){let e=u.document.createElement("script");e.src=s[t],e.type="text/javascript",e.async=!1,e.charset="utf-8",g.appendChild(e)}}});